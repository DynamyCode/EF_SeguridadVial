<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>M. Operario</title>

        <!-- Bootstrap core CSS -->
        <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom fonts for this template -->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
        <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
        <link href="vendor/devicons/css/devicons.min.css" rel="stylesheet">
        <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">
        <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

        <link href="vendor/admin2/sb-admin-2.css" rel="stylesheet">
        <!-- Custom styles for this template -->
        <link href="css/resume.min.css" rel="stylesheet">

    </head>

    <body id="page-top">

        <nav style="background-color: #0634A9" class=" navbar-expand-lg navbar-dark bg " id="sideNav">
            <a class="navbar-brand js-scroll-trigger" href="#page-top">
                <span class="d-none d-lg-block">
                    <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="img/profile.jpg" alt="">
                </span>
            </a>
           
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="#datosPersonales">DATOS PERSONALES</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="#evaluacion">EVALUACION</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="#salir">SALIR</a>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="container-fluid p-0" style="background-color: #EDEDF1">

            <section class="resume-section p-3 p-lg-5 " id="about">
                <div class="my-auto">
                    <h1 class="mb-0">EVALUACION
                        <!--<span class="text-info">Del Futuro</span>-->
                    </h1><hr>


                    <div id="divIntro" class="container">
                        <div class="col-lg-12 text-center">
                            <video id="vidIntro" class="col-lg-offset-2 col-lg-8 col-lg-offset-2" autoplay>
                                <source src="Recursos/intro.mp4" type="video/mp4" />
                                <source src="Recursos/intro.ogg" type="video/ogg" />
                                Su navegador no soporta la reproducción de multimedia
                            </video>
                        </div>
                        <div class="clearfix"></div><br>
                        <div class="col-lg-12 text-center">
                            <button id="btnIniciar" type="button" class="btn btn-primary">Realizar la Evaluacion</button>
                        </div>
                    </div>
                    <div id="divEvaluacion" class="container">
                        <div class="col-lg-12 text-center">
                            <video id="vidEvaluacion" class="col-lg-offset-2 col-lg-8 col-lg-offset-2" controls>
                            </video>
                        </div>
                    </div>
                    <div id="divFinal" class="container">
                        <div class="col-lg-12 text-center">
                            <video id="vidFinal" class="col-lg-offset-2 col-lg-8 col-lg-offset-2">
                            </video>
                        </div>
                    </div>
                    <div id="divResultados">
                        <div class="row">
                            <div class="col-xl-3 col-sm-6 mb-3">
                                <div class="card text-white bg-default o-hidden h-100">
                                    <div class="card-body">
                                        <div class="card-body-icon">

                                            <h5 id="cantRiesgos"> </h5>
                                        </div>
                                        <div class="mr-5" style="color: black">Cantidad de riesgos</div>
                                    </div>

                                </div>
                            </div>


                            <div class="col-xl-3 col-sm-6 mb-3">
                                <div class="card text-white bg-default o-hidden h-100">
                                    <div class="card-body">
                                        <div class="card-body-icon">
                                            <h5 id="cantErrores"></h5>
                                        </div>                                  

                                        <div class="mr-5" style="color: black">Cantidad de errores</div>
                                    </div>

                                </div>
                            </div>


                            <div class="col-xl-3 col-sm-6 mb-3">
                                <div class="card text-white bg-default o-hidden h-100">
                                    <div class="card-body">
                                        <div class="card-body-icon">
                                            <h5 id="cantAciertos"></h5>
                                        </div>     



                                        <div class="mr-5" style="color: black">Cantidad de aciertos</div>
                                    </div>

                                </div>
                            </div>


                            <div class="col-xl-3 col-sm-6 mb-3">
                                <div class="card text-white bg-default o-hidden h-100">
                                    <div class="card-body">
                                        <div class="card-body-icon">
                                            <h5 id="promReacion"> </h5>
                                        </div>     



                                        <div class="mr-6" style="color: black">Promedio de reacción</div>
                                    </div>

                                </div>
                            </div>
                            
                             <div class="col-xl-12 col-sm-2 mb-1">
                                <div class="card text-white bg-default o-hidden h-100">
                                    <div class="card-body">
                                     <h5 id="porcFinal">Porcentaje final: </h5>
                                    </div>

                                </div>
                            </div>


                        </div>

                        
                        <hr>




                        <table style=" border-collapse: separate;">
                           
                            <tbody>
                                <tr >
                                    <td width="50%" style=" padding: 5px; border-right: 1px solid black;" >
                                        <div id="divRiesgos">
                                        </div>
                                    </td>
                                    <td width="50%" style=" padding: 5px;">
                                        <div id="divRiesgosEncontrados" style=" padding: 5px;">
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>


                        <hr>
                    </div>
                </div>
                <audio src="Recursos/sonido1.ogg" id="audClicVideo">  
                    Tu navegador no soporta el elemento 
                    <code>audio</code>
                </audio>
                <div id="divModalsRiesgos"></div>
                <div id="divModalsClicks"></div>
            </section>
        </div>

        <!-- Bootstrap core JavaScript -->
        <script src="vendor/jquery/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
        <script src="vendor/js/sb-admin-2.js"></script>
        <script>
            function puntoRiesgo(inicio, fin) {
                this.inicio = inicio;
                this.fin = fin;
            }
            function puntoRiesgoUser(inicio) {
                this.inicio = inicio;
                this.acierto = 0;
                this.reaccion = 0;
            }
        </script>
        <script>
            var recursoEvaluacion = "Recursos/Video 1.2.mp4";
            var vidEvaluacion = document.getElementById("vidEvaluacion");
            var objArrayRiesgos = [new puntoRiesgo(33, 36)
                        , new puntoRiesgo(65, 73)
                        , new puntoRiesgo(131, 134)
                        , new puntoRiesgo(150, 154)
                        , new puntoRiesgo(187, 189)
                        , new puntoRiesgo(237, 240)
                        , new puntoRiesgo(252, 255)];
            var objArrayRiesgosUser = new Array();

            /*var objArrayRiesgosUser = [new puntoRiesgo(33, 36)
             , new puntoRiesgo(65, 73)
             , new puntoRiesgo(131, 134)
             , new puntoRiesgo(150, 154)
             , new puntoRiesgo(187, 189)
             , new puntoRiesgo(237, 240)
             , new puntoRiesgo(252, 255)];*/

            var cantAciertos = 0;
            var sumReaccion = 0;
            function abrirModal(id, tipo) {
                switch (tipo) {
                    case 1:
                    {
                        $("#modalRiesgo" + id).modal('show');
                        $("#divModalBody" + id).append("<video class='col-lg-12' id='vidModalRiesgo" + id + "'>"
                                + "<source src='" + recursoEvaluacion + "#t="
                                + objArrayRiesgos[id - 1].inicio
                                + "," + objArrayRiesgos[id - 1].fin
                                + "'type='video/mp4'></source>"
                                + "</video>");
                        var vidModalRiesgo = document.getElementById("vidModalRiesgo" + id);
                        vidModalRiesgo.play();
                        break;
                    }
                    case 2:
                    {
                        $("#modalClick" + id).modal('show');
                        break;
                    }
                }
            }
            function cerrarModal(id, tipo) {
                switch (tipo) {
                    case 1:
                    {
                        $("#modalRiesgo" + id).modal('hide');
                        $("#vidModalRiesgo" + id).remove();
                        break;
                    }
                    case 2:
                    {
                        $("#modalClick" + id).modal('hide');
                        break;
                    }
                }
            }
            $(document).ready(function () {
                vidEvaluacion.src = recursoEvaluacion;
                $("#btnIniciar").hide();
                $("#divEvaluacion").hide();
                $("#divFinal").hide();
                $("#divResultados").hide();
                $("#vidIntro").on('ended', function () {
                    $("#btnIniciar").show("slow");
                });
                $("#btnIniciar").click(function () {
                    $("#divIntro").hide("slow");
                    $("#divEvaluacion").show();
                    vidEvaluacion.play();
                });
                $("#vidEvaluacion").on('click', function () {
                    objArrayRiesgosUser.push(new puntoRiesgoUser(vidEvaluacion.currentTime));
                    var audClicVideo = document.getElementsByTagName("audio")[0];
                    audClicVideo.play();
                });
                $("#vidEvaluacion").on('ended', function () {
                    for (i = 0; i < objArrayRiesgosUser.length; i++) {
                        for (j = 0; j < objArrayRiesgos.length; j++) {
                            var inicio = objArrayRiesgos[j].inicio;
                            var fin = objArrayRiesgos[j].fin;
                            var promAcierto = (inicio + fin) / 2;
                            if (objArrayRiesgosUser[i].inicio >= inicio & objArrayRiesgosUser[i].inicio <= fin) {
                                objArrayRiesgosUser[i].acierto = 1;
                                objArrayRiesgosUser[i].reaccion = promAcierto - objArrayRiesgosUser[i].inicio;
                            }
                        }
                    }
                    for (i = 0; i < objArrayRiesgosUser.length; i++) {
                        if (objArrayRiesgosUser[i].acierto === 1) {
                            cantAciertos = cantAciertos + 1;
                            sumReaccion = sumReaccion + objArrayRiesgosUser[i].reaccion;
                        }
                    }
                    $("#divEvaluacion").hide();
                    $("#divFinal").show("slow");
                    if (cantAciertos / objArrayRiesgos.length > 0.66) {
                        var vidFinal = document.getElementById("vidFinal");
                        $("#vidFinal").html('<source src="Recursos/01 - PuntuacionAlta.mp4" type="video/mp4"></source>');
                        vidFinal.play();
                    } else if (cantAciertos / objArrayRiesgos.length > 0.33) {
                        var vidFinal = document.getElementById("vidFinal");
                        $("#vidFinal").html('<source src="Recursos/02 - PuntuacionMedia.mp4" type="video/mp4"></source>');
                        vidFinal.play();
                    } else {
                        var vidFinal = document.getElementById("vidFinal");
                        $("#vidFinal").html('<source src="Recursos/03 - PuntuacionBaja.mp4" type="video/mp4"></source>');
                        vidFinal.play();
                    }
                    for (i = 0; i < objArrayRiesgos.length; i++) {
                        var video = "<div class='btn alert-default col-lg-4 '  onclick='abrirModal(" + (i + 1) + ",1)'>"
                                        + "<div >"
                                            + "<h5 class='mb-1'>Riesgo " + (i + 1) + "</h5>"
                                        + "</div>"
                                        + "<video class='col-lg-12'>"
                                            + "<source src='" + recursoEvaluacion + "#t="
                                            + objArrayRiesgos[i].inicio
                                            + "," + objArrayRiesgos[i].fin
                                            + "' type='video/mp4'/>"
                                        + "</video>"                                           
                                + "</div>";
                        $('#divRiesgos').append(video);
                        var modal = "<div class='modal fade' id='modalRiesgo" + (i + 1) + "' role='dialog' data-backdrop='static' data-keyboard='false'>"
                                + "<div class='modal-dialog'>"
                                + "<div class='modal-content'>"
                                + "<div class='modal-header'>"
                                + "<h4 class='modal-title'>Riesgo " + (i + 1) + "</h4>"
                                + "</div>"
                                + "<div class='modal-body' id='divModalBody" + (i + 1) + "'>"
                                + "</div>"
                                + "<div class='modal-footer'>"
                                + "<button type='button' class='btn btn-default' onclick='cerrarModal(" + (i + 1) + ",1)'>Cerrar</button>"
                                + "</div>"
                                + "</div>"
                                + "</div>"
                                + "</div>";
                        $('#divModalsRiesgos').append(modal);
                    }
                    for (i = 0; i < objArrayRiesgosUser.length; i++) {
                        if (objArrayRiesgosUser[i].acierto === 1)
                            var video = "<div class='btn alert-default col-lg-4 '  onclick='abrirModal(" + (i + 1) + ",2)'>"
                                    + "<div>"
                                    + "<h5 class='mb-1' style='color: green'>Clic " + (i + 1) + "</h5>"
                                    + "</div>"
                                 
                                    + "<video class='col-lg-12'>"
                                        + "<source src='" + recursoEvaluacion + "#t="
                                        + objArrayRiesgosUser[i].inicio
                                        + "," + (objArrayRiesgosUser[i].inicio + 0.01)
                                        + "' type='video/mp4'/>"
                                    + "</video>"
                                    
                                    + "</div>";
                        else
                            var video = "<div class='btn alert-default col-lg-4 '   onclick='abrirModal(" + (i + 1) + ",2)'>"
                                            + "<div>"
                                                + "<h5 class='mb-1' style='color: red'>Clic " + (i + 1) + "</h5>"
                                            + "</div>"

                                            + "<video class='col-lg-12'>"
                                                + "<source src='" + recursoEvaluacion + "#t="
                                                + objArrayRiesgosUser[i].inicio
                                                + "," + (objArrayRiesgosUser[i].inicio + 0.01)
                                                + "' type='video/mp4'/>"
                                            + "</video>"
                                    + "</div>";
                        $('#divRiesgosEncontrados').append(video);
                        var modal = "<div class='modal fade' id='modalClick" + (i + 1) + "' role='dialog' data-backdrop='static' data-keyboard='false'>"
                                + "<div class='modal-dialog'>"
                                + "<div class='modal-content'>"
                                + "<div class='modal-header'>"
                                + "<h4 class='modal-title'>Intento " + (i + 1) + "</h4>"
                                + "</div>"
                                + "<div class='modal-body' id='divModalBodyClick" + (i + 1) + "'>"
                                + "<video class='col-lg-12' id='vidModalClick" + (i + 1) + "'>"
                                + "<source src='" + recursoEvaluacion + "#t="
                                + objArrayRiesgosUser[i].inicio
                                + "," + (objArrayRiesgosUser[i].inicio + 0.01)
                                + "'type='video/mp4'></source>"
                                + "</video>"
                                + "</div>"
                                + "<div class='modal-footer'>"
                                + "<button type='button' class='btn btn-default' onclick='cerrarModal(" + (i + 1) + ",2)'>Cerrar</button>"
                                + "</div>"
                                + "</div>"
                                + "</div>"
                                + "</div>";
                        $('#divModalsClicks').append(modal);
                    }
                });
                $("#vidFinal").on('ended', function () {
                    $("#divFinal").hide();
                    $("#divResultados").show("slow");
                    $("#cantRiesgos").append($("#cantRiesgos").val() + objArrayRiesgos.length);
                    $("#cantAciertos").append($("#cantAciertos").val() + cantAciertos);
                    $("#cantErrores").append($("#cantErrores").val() + objArrayRiesgosUser.length - cantAciertos);
                    $("#promReacion").append($("#promReacion").val() + (sumReaccion / cantAciertos));
                    $("#porcFinal").append($("#porcFinal").val() + ((cantAciertos / objArrayRiesgos.length) * 100).toFixed(3));
                });
            });
        </script>
    </body>
</html>
